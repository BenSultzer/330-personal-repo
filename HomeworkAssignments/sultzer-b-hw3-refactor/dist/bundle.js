(()=>{"use strict";var e=function(e,t){return Math.random()*(t-e)+e};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,r(o.key),o)}}function r(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}var o=function(){return e=function e(t,n,r,o,a,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.positionX=t,this.positionY=n,this.radius=r,this.color=o,this.speed=a,this.direction=new Array(i[0],i[1]),this.normalize(i),this.acceleration=1,this.shockwaveType="normal"},t=[{key:"normalize",value:function(e){var t=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2));return e[0]/=t,e[1]/=t,e}},{key:"exertShockwave",value:function(e,t){var n=Math.sqrt(Math.pow(this.positionX-e,2)+Math.pow(this.positionY-t,2)),r=new Array(2);r[0]=this.positionX-e,r[1]=this.positionY-t;var o=this.normalize(r);this.direction[0]+=o[0],this.direction[1]+=o[1],"freeze"==this.shockwaveType?this.speed*=15/n:this.speed*=1.5}},{key:"setShockwaveType",value:function(e){this.shockwaveType=e}},{key:"setGravity",value:function(e){this.acceleration=e}},{key:"update",value:function(e){this.direction[1]+=this.acceleration*e,this.positionX+=this.direction[0]*this.speed*e,this.positionY+=this.direction[1]*this.speed*e}},{key:"draw",value:function(e){this.drawCircle(e,this.positionX,this.positionY,this.radius,this.color)}},{key:"drawCircle",value:function(e,t,n,r,o){e.save(),e.fillStyle=o,e.beginPath(),e.arc(t,n,r,0,2*Math.PI),e.closePath(),e.fill(),e.restore()}}],t&&n(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function c(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}var u,l,s,y,d,p,v,h,f,m,g,w,b,S,q,k,T,M,E=function(){return t=function e(t,n,r,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.positionX=t,this.positionY=n,this.particles=new Array(r),this.particleRadius=o,this.particleColor=a,this.createParticleSystem()},n=[{key:"createParticleSystem",value:function(){for(var t=0;t<this.particles.length;t++)this.particles[t]=new o(this.positionX,this.positionY,this.particleRadius,this.particleColor,e(100,200),new Array(e(-1,1),e(-1,1)))}},{key:"update",value:function(e,t){for(var n=0;n<this.particles.length;n++)this.particles[n].update(t),this.particles[n].draw(e)}}],n&&i(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}(),A=0,P=0,L=0,C=-1,j="fountain",z="normal",F=1,H=0,R=0,x="frequency",X=Object.freeze({gain:.5,numSamples:256}),O=function(e){f.src=e},Y={showParticleSystems:!0,showParticles:!0,partyMode:!1,showEmboss:!1},V=Object.freeze({sound1:"media/New Adventure Theme.mp3"}),B=function(e){for(var t=e.target.getBoundingClientRect(),n=e.clientX-t.x,r=e.clientY-t.y,o=0;o<l.length;o++)l[o].exertShockwave(n,r)},D=function(e){document.querySelector("#fs-button").onclick=function(t){var n;console.log("goFullscreen() called"),(n=e).requestFullscreen?n.requestFullscreen():n.mozRequestFullscreen?n.mozRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()};var t=document.querySelector("#play-button");t.onclick=function(e){console.log("audioCtx.state before = ".concat(h.state)),"suspended"==h.state&&h.resume(),console.log("audioCtx.state after = ".concat(h.state)),"no"==e.target.dataset.playing?(f.play(),e.target.dataset.playing="yes"):(f.pause(),e.target.dataset.playing="no")};var n=document.querySelector("#volume-slider"),r=document.querySelector("#volume-label");n.oninput=function(e){var t;t=e.target.value,t=Number(t),w.gain.value=t,r.innerHTML=Math.round(e.target.value/2*100)},n.dispatchEvent(new Event("input"));var o=document.querySelector("#gravity-slider"),a=document.querySelector("#gravity-label");o.oninput=function(e){var t;t=e.target.value,C=t,a.innerHTML=e.target.value},o.value="1",o.dispatchEvent(new Event("input"));var i=document.querySelector("#speed-slider"),c=document.querySelector("#speed-label");i.oninput=function(e){var t;t=e.target.value,F=t,c.innerHTML=e.target.value},i.value="1",i.dispatchEvent(new Event("input"));var u=document.querySelector("#treble-slider"),l=document.querySelector("#treble-label");u.oninput=function(e){var t;t=e.target.value,b.gain.setValueAtTime(t,h.currentTime),l.innerHTML=e.target.value},u.value="0",u.dispatchEvent(new Event("input"));var s=document.querySelector("#bass-slider"),y=document.querySelector("#bass-label");s.oninput=function(e){var t;t=e.target.value,S.gain.setValueAtTime(t,h.currentTime),y.innerHTML=e.target.value},s.value="0",s.dispatchEvent(new Event("input")),document.querySelector("#track-select").onchange=function(e){O(e.target.value),"yes"==t.dataset.playing&&t.dispatchEvent(new MouseEvent("click"))},document.querySelector("#particle-systems-cb").addEventListener("click",(function(e){Y.showParticleSystems=e.target.checked})),document.querySelector("#particles-cb").addEventListener("click",(function(e){Y.showParticles=e.target.checked})),document.querySelector("#party-cb").addEventListener("click",(function(e){Y.partyMode=e.target.checked})),document.querySelector("#emboss-cb").addEventListener("click",(function(e){Y.showEmboss=e.target.checked}))},N=function t(){setTimeout(t,1e3/60),function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(P=A,L=(A+=1/60)-P,"frequency"==x?p.getByteFrequencyData(v):p.getByteTimeDomainData(v),s.save(),s.fillStyle="black",s.fillRect(0,0,y,d),s.restore(),t.showParticleSystems){var n=(y-4*v.length-10)/v.length;s.save();for(var r=0;r<v.length;r++)(H+=1/60)>=1.3&&(u[r]=new E(5+r*(n+4),356-v[r],5,(256-v[r]+20)/10,"rgba(50, 50, 50, 0.75)"),H=0);if("yes"==document.querySelector("#play-button").dataset.playing)for(var a=0;a<u.length;a++)u[a].update(s,L);s.restore()}if(t.showParticles){s.save();for(var i=0;i<v.length;i++)if((R+=1/60)>=3){var c=void 0,h=void 0;"fountain"==j?(c=new Array(e(-1,1),e(-1,1)),h=(100+v[i])*F):(c=new Array(Math.sin(3*A),-1),h=(200+v[i])*F),l[i]=new o(y/2,d/2,(256-v[i]+20)/10,"rgba(".concat(175+v[i],", 0, 0, 0.75)"),h,c),l[i].setGravity(C),R=0}if("yes"==document.querySelector("#play-button").dataset.playing)for(var f=0;f<l.length;f++)l[f].setShockwaveType(z),l[f].update(L),l[f].draw(s);s.restore()}for(var m=s.getImageData(0,0,y,d),g=m.data,w=g.length,b=m.width,S=0;S<w;S+=4)if(t.partyMode&&(g[S]+=100*Math.sin(10*A),g[S+1]+=100*Math.sin(A),g[S+2]+=100*Math.sin(A)),-1==C){var q=g[S],k=g[S+1],T=g[S+2];g[S]=255-q,g[S+1]=255-k,g[S+2]=255-T}if(t.showEmboss)for(var M=0;M<w;M++)M%4!=3&&(g[M]=127+2*g[M]-g[M+4]-g[M+4*b]);s.putImageData(m,0,0)}(Y)};console.log("startUp() called"),function(){var e,t;e=V.sound1,t=window.AudioContext||window.webkitAudioContext,h=new t,f=new Audio,O(e),m=h.createMediaElementSource(f),(g=h.createAnalyser()).fftSize=X.numSamples,(w=h.createGain()).gain.value=X.gain,b=function(e){var t=e.createBiquadFilter();return t.type="highshelf",t.frequency.setValueAtTime(1e3,e.currentTime),t.gain.setValueAtTime(0,e.currentTime),t}(h),S=function(e){var t=e.createBiquadFilter();return t.type="lowshelf",t.frequency.setValueAtTime(1e3,e.currentTime),t.gain.setValueAtTime(0,e.currentTime),t}(h),m.connect(b),b.connect(S),S.connect(g),g.connect(w),w.connect(h.destination),console.log("init called");var n,r=document.querySelector("canvas");D(r),function(e,t){s=e.getContext("2d"),y=e.width,d=e.height,p=t,v=new Uint8Array(p.fftSize/2),u=new Array(v.length);for(var n=0;n<u.length;n++)u[n]=new E(0,0,0,0,"white");l=new Array(v.length);for(var r=0;r<l.length;r++)l[r]=new o(y/2,d/2,0,"white",0,new Array(0,0))}(r,g),r.addEventListener("click",B),(n=new XMLHttpRequest).onload=function(e){var t;try{t=JSON.parse(e.target.responseText)}catch(e){return void(document.querySelector("#app-description").innerHTML="An error occurred loading app set-up data.")}var n=Object.keys(t);q=t[n[0]],k=t[n[1]],T=t[n[2]],M=t[n[3]],document.querySelector("title").innerHTML=q;for(var r=0;r<k.length;r++)"New Adventure Theme"==T[r]?document.querySelector("#track-select").innerHTML+='<option value="media/'.concat(k[r],'" selected>').concat(T[r],"</option>"):document.querySelector("#track-select").innerHTML+='<option value="media/'.concat(k[r],'">').concat(T[r],"</option>");document.querySelector("#app-description").innerHTML=M},n.onerror=function(e){return console.log("In onerror - HTTP Status Code = ".concat(e.target.status))},n.open("GET","data/av-data.json"),n.send(),document.querySelector("#track-select").value="media/New Adventure Theme.mp3",document.querySelector("#particle-systems-cb").checked=!0,document.querySelector("#particles-cb").checked=!0,document.querySelector("#party-cb").checked=!1,document.querySelector("#emboss-cb").checked=!1,document.querySelector("#analyser-data-type").value="frequency",document.querySelector("#analyser-data-type").onchange=function(){var e;e=document.querySelector("#analyser-data-type").value,x=e},document.querySelector("#emitter-type").value="fountain",document.querySelector("#emitter-type").onchange=function(){var e;e=document.querySelector("#emitter-type").value,j=e},document.querySelector("#shockwave-type").value="normal",document.querySelector("#shockwave-type").onchange=function(){var e;e=document.querySelector("#shockwave-type").value,z=e},N()}()})();